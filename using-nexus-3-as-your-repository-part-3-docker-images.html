<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Using Nexus 3 as Your Repository - Part 3: Docker Images</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154633858-1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-154633858-1');
</script><link href="//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" rel="stylesheet" type="text/css"/><link rel="canonical" href="https://rafaeleyng.github.io//using-nexus-3-as-your-repository-part-3-docker-images"/><meta name="description" content=""/><meta name="language" content="en"/><meta name="content-language" content="en"/><meta name="author" content="Rafael Eyng"/><meta name="keywords" content="software, development, javascript, github, node, docker, blog"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="next-head-count" content="11"/><link rel="preload" href="/_next/static/oZ4QsuvSe1R-aGNaismwu/pages/post.js" as="script"/><link rel="preload" href="/_next/static/oZ4QsuvSe1R-aGNaismwu/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.bc93fc63b1408a8cadb6.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-b1511fc684da8c38d25b.js" as="script"/><link rel="preload" href="/_next/static/css/commons.1c2d60be.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/commons.1c2d60be.chunk.css"/></head><body><div id="__next"><div class="container"><header class="site-header single-column"><a class="blog-title" href="/">Rafael Eyng&#x27;s Blog</a><nav class="blog-menu"><a href="https://rafaeleyng.github.io/me" target="_blank">About</a><a href="https://github.com/rafaeleyng/rafaeleyng.github.io" target="_blank">Github</a></nav></header></div><header class="page-header"><div class="container single-column"><h1>Using Nexus 3 as Your Repository - Part 3: Docker Images</h1><p class="post-meta"><time itemProp="datePublished" dateTime="2017-01-07">Jan 7, 2017</time></p></div></header><main class="container single-column"><section class="post"><span class="hidden" itemProp="publisher">Rafael Eyng</span><span class="hidden" itemProp="keywords">nexus, repository, private, proxy, docker</span><article class="post-content" itemProp="articleBody"><div><p><small>
This is the third and last part of a series of posts on Nexus 3 and how to use it as repository for several technologies.
</small></p></div><h2>Installation</h2><p>Check out the <a href="https://rafaeleyng.github.io/using-nexus-3-as-your-repository-part-1-maven-artifacts/">first part</a> of this series to see how we installed and ran Nexus 3 using a single docker command. Just do that and the installation is done.</p><h2>Configuring Nexus as a Docker repo</h2><p>What we will do:</p><ul><li>create a private (hosted) repository for our own images</li><li>create a proxy repository pointing to Docker Hub</li><li>create a group repository to provide all the above repos under a single URL</li></ul><p>I suggest you to create a new blob store for each new repo you want to create. That way, the data for every repo will be in a different folder in <code>/nexus-data</code> (inside the Docker container). But this is not mandatory for it to work.</p><p>By default, the Docker client communicates with the repo using HTTPS. In my use case I had to configure it with HTTP, because we didn’t have the certificate nor the knowledge on how to obtain it.</p><p>Important to notice: the Docker repo requires 2 different ports. We are going to use 8082 for pull from the proxy repo and 8083 for pull and push to the private repo.</p><p>I had some problems with slightly older versions of Docker, so I strongly suggesting you to start with the version that I’ve tested with, that is <code>1.12.3</code>.</p><h3>private repo</h3><p>A repository for Docker images that your team creates.</p><p>Create a new Docker (hosted) repository and configure it like:</p><p><img alt="docker-private" src="https://cloud.githubusercontent.com/assets/4842605/21745036/25e11fc2-d509-11e6-85f6-6b6e016c174e.png"/></p><h3>proxy repo</h3><p>A repository that proxies everything you download from the official registry, Docker Hub. Next time you download the same dependency, it will be cached in your Nexus.</p><p>Create a new Docker (proxy) repository and configure it like:</p><p><img alt="docker-hub0" src="https://cloud.githubusercontent.com/assets/4842605/21745035/25daf822-d509-11e6-892b-11f79943f96b.png"/></p><p><img alt="docker-hub1" src="https://cloud.githubusercontent.com/assets/4842605/21745034/25d9eebe-d509-11e6-9e28-fd7f63b4ae89.png"/></p><h3>group repo</h3><p>This will group all the above repos and provide you a single URL to configure your clients to download from/deploy to.</p><p>Create a new Docker (group) repository and configure it like:</p><p><img alt="docker-group0" src="https://cloud.githubusercontent.com/assets/4842605/21745032/25a805de-d509-11e6-80c4-989500a2d579.png"/></p><p><img alt="docker-group1" src="https://cloud.githubusercontent.com/assets/4842605/21745033/25c7919c-d509-11e6-89d2-88d631f343ee.png"/></p><p>You can create as many repos as you need and group them all in the group repo.</p><p>This step is actually optional to use Nexus 3 as a Docker repository, because we can stick to pulling and pushing to the proxy and hosted repositories as will be discussed later.</p><h2>Configuring your clients and projects to use your Nexus repos</h2><p>To interact with your repo, the first thing is to configure the Docker daemon in your machine to accept working with HTTP instead of HTTPS.</p><p>How exactly to do this config depends on your operating system, so you should check <a href="https://docs.docker.com/engine/reference/commandline/dockerd/">dockerd</a> documentation. On RHEL I did it putting this content in <code>/etc/docker/daemon.json</code>:</p><pre><code>{
  &quot;insecure-registries&quot;: [
    &quot;your-repo:8082&quot;,
    &quot;your-repo:8083&quot;
  ],
  &quot;disable-legacy-registry&quot;: true
}</code></pre><p>You have to restart the daemon after setting this (<code>sudo systemctl restart docker</code>).</p><p>On Windows or Mac you should config your deamon in a box like this:</p><p><img alt="daemon" src="https://cloud.githubusercontent.com/assets/4842605/21745349/f8af75b4-d510-11e6-8383-c3594b525ea4.png"/></p><p>Now we have to authenticate your machine to the repo with:</p><pre><code>docker login -u admin -p admin123 your-repo:8082
docker login -u admin -p admin123 your-repo:8083</code></pre><p>Remember the default Nexus credentials, <code>admin/admin123</code>. This will create an entry in <code>~/.docker/config.json</code>:</p><pre><code>{
	&quot;auths&quot;: {
		&quot;your-repo:8082&quot;: {
			&quot;auth&quot;: &quot;YWRtaW46YWRtaW4xMjM=&quot;
		},
		&quot;your-repo:8083&quot;: {
			&quot;auth&quot;: &quot;YWRtaW46YWRtaW4xMjM=&quot;
		}
}</code></pre><p>To pull images from your repo, use (notice port 8082 being used):</p><pre><code>docker pull your-repo:8082/httpd:2.4-alpine</code></pre><p>To push your own images to your repo, you have to tag the image with a tag that points to the repo. This is strange to me, since I was trying to think about Docker tags the same way I do about Git tags, but they seem be somewhat different (notice port 8083 being used):</p><pre><code>docker tag your-own-image:1 your-repo:8083/your-own-image:1
docker push your-repo:8083/your-own-image:1</code></pre><p>To pull your own images from the repo, you can use:</p><pre><code>docker tag your-own-image:1 your-repo:8082/your-own-image:1
# or
docker tag your-own-image:1 your-repo:8083/your-own-image:1</code></pre><p>Both ports will work. I suspect that is because using port 8083 will connect directly to the hosted repo, whilst using port 8082 will connect to the group repo, which contains the hosted repo. I suggest you to stick to port 8083 to avoid duplicate images in your machines. If you chose to stick with port 8083 to pull your own images, you probably could skip creating the group repo, if you prefer.</p></article><div id="disqus_thread"></div><script type="text/javascript">
var disqus_config = function () {
  this.page.url = 'https://rafaeleyng.github.io/using-nexus-3-as-your-repository-part-3-docker-images';
  this.page.identifier = '/using-nexus-3-as-your-repository-part-3-docker-images';
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://rafaeleyng.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></section></main></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{"post":{"document":{"content":"\n\u003cp\u003e\u003csmall\u003e\nThis is the third and last part of a series of posts on Nexus 3 and how to use it as repository for several technologies.\n\u003c/small\u003e\u003c/p\u003e\n\n## Installation\n\nCheck out the [first part](https://rafaeleyng.github.io/using-nexus-3-as-your-repository-part-1-maven-artifacts/) of this series to see how we installed and ran Nexus 3 using a single docker command. Just do that and the installation is done.\n\n## Configuring Nexus as a Docker repo\n\nWhat we will do:\n  - create a private (hosted) repository for our own images\n  - create a proxy repository pointing to Docker Hub\n  - create a group repository to provide all the above repos under a single URL\n\nI suggest you to create a new blob store for each new repo you want to create. That way, the data for every repo will be in a different folder in `/nexus-data` (inside the Docker container). But this is not mandatory for it to work.\n\nBy default, the Docker client communicates with the repo using HTTPS. In my use case I had to configure it with HTTP, because we didn’t have the certificate nor the knowledge on how to obtain it.\n\nImportant to notice: the Docker repo requires 2 different ports. We are going to use 8082 for pull from the proxy repo and 8083 for pull and push to the private repo.\n\nI had some problems with slightly older versions of Docker, so I strongly suggesting you to start with the version that I’ve tested with, that is `1.12.3`.\n\n### private repo\n\nA repository for Docker images that your team creates.\n\nCreate a new Docker (hosted) repository and configure it like:\n\n![docker-private](https://cloud.githubusercontent.com/assets/4842605/21745036/25e11fc2-d509-11e6-85f6-6b6e016c174e.png)\n\n### proxy repo\n\nA repository that proxies everything you download from the official registry, Docker Hub. Next time you download the same dependency, it will be cached in your Nexus.\n\nCreate a new Docker (proxy) repository and configure it like:\n\n![docker-hub0](https://cloud.githubusercontent.com/assets/4842605/21745035/25daf822-d509-11e6-892b-11f79943f96b.png)\n\n![docker-hub1](https://cloud.githubusercontent.com/assets/4842605/21745034/25d9eebe-d509-11e6-9e28-fd7f63b4ae89.png)\n\n### group repo\n\nThis will group all the above repos and provide you a single URL to configure your clients to download from/deploy to.\n\nCreate a new Docker (group) repository and configure it like:\n\n![docker-group0](https://cloud.githubusercontent.com/assets/4842605/21745032/25a805de-d509-11e6-80c4-989500a2d579.png)\n\n![docker-group1](https://cloud.githubusercontent.com/assets/4842605/21745033/25c7919c-d509-11e6-89d2-88d631f343ee.png)\n\nYou can create as many repos as you need and group them all in the group repo.\n\nThis step is actually optional to use Nexus 3 as a Docker repository, because we can stick to pulling and pushing to the proxy and hosted repositories as will be discussed later.\n\n## Configuring your clients and projects to use your Nexus repos\n\nTo interact with your repo, the first thing is to configure the Docker daemon in your machine to accept working with HTTP instead of HTTPS.\n\nHow exactly to do this config depends on your operating system, so you should check [dockerd](https://docs.docker.com/engine/reference/commandline/dockerd/) documentation. On RHEL I did it putting this content in `/etc/docker/daemon.json`:\n\n```\n{\n  \"insecure-registries\": [\n    \"your-repo:8082\",\n    \"your-repo:8083\"\n  ],\n  \"disable-legacy-registry\": true\n}\n```\n\nYou have to restart the daemon after setting this (`sudo systemctl restart docker`).\n\nOn Windows or Mac you should config your deamon in a box like this:\n\n![daemon](https://cloud.githubusercontent.com/assets/4842605/21745349/f8af75b4-d510-11e6-8383-c3594b525ea4.png)\n\nNow we have to authenticate your machine to the repo with:\n\n```\ndocker login -u admin -p admin123 your-repo:8082\ndocker login -u admin -p admin123 your-repo:8083\n```\n\nRemember the default Nexus credentials, `admin/admin123`. This will create an entry in `~/.docker/config.json`:\n\n```\n{\n\t\"auths\": {\n\t\t\"your-repo:8082\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4xMjM=\"\n\t\t},\n\t\t\"your-repo:8083\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4xMjM=\"\n\t\t}\n}\n```\n\nTo pull images from your repo, use (notice port 8082 being used):\n\n```\ndocker pull your-repo:8082/httpd:2.4-alpine\n```\n\nTo push your own images to your repo, you have to tag the image with a tag that points to the repo. This is strange to me, since I was trying to think about Docker tags the same way I do about Git tags, but they seem be somewhat different (notice port 8083 being used):\n\n```\ndocker tag your-own-image:1 your-repo:8083/your-own-image:1\ndocker push your-repo:8083/your-own-image:1\n```\n\nTo pull your own images from the repo, you can use:\n\n```\ndocker tag your-own-image:1 your-repo:8082/your-own-image:1\n# or\ndocker tag your-own-image:1 your-repo:8083/your-own-image:1\n```\n\nBoth ports will work. I suspect that is because using port 8083 will connect directly to the hosted repo, whilst using port 8082 will connect to the group repo, which contains the hosted repo. I suggest you to stick to port 8083 to avoid duplicate images in your machines. If you chose to stick with port 8083 to pull your own images, you probably could skip creating the group repo, if you prefer.\n","data":{"title":"Using Nexus 3 as Your Repository - Part 3: Docker Images","date":"2017-01-07T19:37:14.000Z","keywords":"nexus, repository, private, proxy, docker","excerpt":"In this third post of the series, we will setup Nexus 3 to use it as Docker private registry and as a proxy to Docker Hub.\n"}},"slug":"using-nexus-3-as-your-repository-part-3-docker-images"}}},"page":"/post","query":{"slug":"using-nexus-3-as-your-repository-part-3-docker-images"},"buildId":"oZ4QsuvSe1R-aGNaismwu","nextExport":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-a89f9ba1997a5c81dcc9.js"></script><script async="" data-next-page="/post" src="/_next/static/oZ4QsuvSe1R-aGNaismwu/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/oZ4QsuvSe1R-aGNaismwu/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/commons.bc93fc63b1408a8cadb6.js" async=""></script><script src="/_next/static/runtime/main-b1511fc684da8c38d25b.js" async=""></script></body></html>